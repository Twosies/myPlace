<html>
<head>
  <title>MyPlace</title>
  <script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
  <script id="test">
    //console.log("hi helo");
  </script>
  <script>
    //console.log($('#test', $("<script id=\"test\">\nconsole.log(\"hi helo\");\n</sc"+"ript>")));
    $.get("https://cors-anywhere.herokuapp.com/https://reddit.com/place", function(data) {
      // This is a stupidly compact line of code.  I have no excuse.
      var uniqueWSURL = $.parseJSON($(data).filter("#config").text().match(/r\.setup\((.*)\)/)[1]).place_websocket_url;

      console.log("Connecting to " + uniqueWSURL);

      var socket = new WebSocket(uniqueWSURL);
//
      //document.write("helo");
      socket.onmessage = function(event) {
        $('#feed').append('<div class="feed-item">' + event.data + '</div>');
        if($('#feed .feed-item').length > 10) {
          $('#feed .feed-item:first').remove();
        }
      }
    });
  </script>
</head>
<body>
  <h1>MyPlace</h1>
  <p>The all-seeing eye of /r/place</p>
  <h2>Heatmap</h2>
  <canvas id="heatmap" width="1000" height="1000"></canvas>
  <h2>Live Feed</h2>
  <div id="feed"></div>
</body>
